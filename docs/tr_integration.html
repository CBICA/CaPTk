<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cancer Imaging Phenomics Toolkit (CaPTk): Integrating your Application in CaPTk</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cancer Imaging Phenomics Toolkit (CaPTk)
   &#160;<span id="projectnumber">1.7.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tr_integration.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Integrating your Application in CaPTk </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CaPTk is developed and maintained by the Center for Biomedical Image Computing and Analytics (CBICA) at the University of Pennsylvania, and draws upon research from several groups within the Center.</p>
<p>New applications, written in any programming language, can be integrated into CaPTk at different levels. These applications can then run within CaPTk, while having direct access to the full breadth of CaPTk’s interactive capabilities.</p>
<ul>
<li>
<b>Source level integration</b>: At this level, the new application source code (C++) is compiled alongside CaPTk, ensuring the most optimized integration. Source-level integration is straight-forward (only requiring additions to relevant CMake files and minor additions to the interactive base) if the new application relies on a subset of CaPTk’s dependencies (i.e., ITK, VTK, OpenCV, Qt).  </li>
<li>
<b>Executable level integration</b>: This level provides a graphical interface to an existing command-line application (not necessarily developed in C++), allowing users to leverage CaPTk’s functionality (e.g., interaction, feature extraction). Executable-level integration requires only minor additions to CaPTk to create a menu option for the new application.  </li>
</ul>
<p>Almost every application of CaPTk has an accompanying command-line executable (with more on the way). Those programs can be called directly, making the CaPTk applications available as components within a larger pipeline or for efficient batch processing of large numbers of images.</p>
<hr  />
<p>We will provide the technical details of the Cancer Imaging Phenomics Toolkit (<b>CaPTk</b>) using which new applications can be integrated into the global framework and also optimize/improve the code. For any questions/details, please feel free to email <a href="#" onclick="location.href='mai'+'lto:'+'sof'+'tw'+'are'+'@c'+'bic'+'a.'+'upe'+'nn'+'.ed'+'u'; return false;">software@cbica.upenn.edu</a>.</p>
<div class="image">
<img src="10_integration_resize.png" alt=""/>
<div class="caption">
Different layers of application integration in CaPTk</div></div>
 <p>Applications written in any language can be integrated with CaPTk via calls to stand-alone command line executables, but deeper integration (including data passing via objects in-memory and access to full breadth of interactive capabilities of the CaPTk Console) is only possible with applications written in C++ (<a href="https://isocpp.org/">https://isocpp.org/</a>).</p>
<ul>
<li>LIBRA, in its current form (MATLAB executable) has the least possible integration with the CaPTk Console; the console can call the executable, which launches its own UI for the user.</li>
<li>ITK-SNAP is an example of integration where CaPTk Console communicates with the application using the provided API; in this case CaPTk ensures that the loaded images, ROIs, masks, etc. are all passed to ITK-SNAP and the result from the segmentation step there gets passed to the console for visualization after ITK-SNAP is closed.</li>
<li>SBRT Lung is an example of integration with a stand-alone CLI application. The Console calls the executable in accordance with CLI, passes the loaded images and ROIs, etc. and visualizes the result when the application is done.</li>
<li>EGFRvIII Surrogate Index provides the tightest possible integration with the CaPTk Console. All data (loaded images, ROIs, etc.) is passed in-memory and the visualization of results happens instantaneously.</li>
<li>All functions available in native C++ libraries (ITK (<a href="https://itk.org/">https://itk.org/</a>), OpenCV (<a href="http://opencv.org/">http://opencv.org/</a>), VTK (<a href="http://www.vtk.org/">http://www.vtk.org/</a>)) are available for native applications to use.</li>
</ul>
<p>You need to compile CaPTk from source to proceed. The following sections give that information.</p>
<hr  />
<h1><a class="anchor" id="tr_sourceBuid"></a>
Building CaPTk from Sources</h1>
<h2><a class="anchor" id="tr_sb_prerequisites"></a>
Prerequisites</h2>
<p>Source code for the CaPTk graphical interface and applications is distributed for sites that wish to examine the code, collaborate with CBICA in future development, and for compatibility.</p>
<p>For end-to-end build examples for Windows/Linux (Ubuntu Xenial)/macOS (10.13), please see our <a href="https://github.com/CBICA/CaPTk/blob/master/azure-pipelines.yml">Azure Pipelines configuration file</a>.</p>
<p>Before building CaPTk, the following software libraries are required to be installed. <b>Please note</b> that to build in Windows, CMake needs to be used an appropriate compiler (Win64 version of Visual Studio is recommended). The selected solution platform is needed to match with dependent libraries.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Package </th><th class="markdownTableHeadNone">Version </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Archiver or Git </td><td class="markdownTableBodyNone">N.A. </td><td class="markdownTableBodyNone">- <b>Windows</b>: Built-in unzip tool<br  />
- <b>Linux</b>: <a href="https://www.gzip.org/">gzip</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">C++ compiler </td><td class="markdownTableBodyNone">C++11 compliance needed </td><td class="markdownTableBodyNone">- <b>Windows</b>: Visual Studio 2015/2017<br  />
- <b>Linux</b>: GCC/4.9.2-7.4.0<br  />
- <b>macOS</b>: CLang 10.0.0, LLVM 6.0.1  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OpenGL </td><td class="markdownTableBodyNone">3.2+ (hardware-dependent) </td><td class="markdownTableBodyNone">- <b>Windows/macOS</b>: Update graphics drivers<br  />
- <b>Ubuntu</b>: apt-get install libgl-dev<br  />
- <b>CentOS</b>: yum install mesa-libGL-devel<br  />
- <a href="FAQ.html#gs_FAQ_3">Details in FAQ</a>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://cmake.org/files/">CMake</a> </td><td class="markdownTableBodyNone">3.10 - 3.12 </td><td class="markdownTableBodyNone">To configure the CaPTk compilation along with its dependencies (via Superbuild).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X11 [Linux-only] </td><td class="markdownTableBodyNone">N.A. </td><td class="markdownTableBodyNone">- <b>Ubuntu</b>: apt-get install libxkbcommon-x11-0<br  />
- <b>CentOS</b>: yum install libXt-deve  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dos2unix [Linux-only] </td><td class="markdownTableBodyNone">N.A. </td><td class="markdownTableBodyNone">- <b>Ubuntu</b>: apt-get install dos2unix<br  />
- <b>CentOS</b>: yum install dos2unix  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="http://doxygen.nl/">Doxygen</a> </td><td class="markdownTableBodyNone">1.8+ </td><td class="markdownTableBodyNone">OPTIONAL: For documentation only.  </td></tr>
</table>
<p>Ensure all dependencies are met before proceeding.</p>
<hr  />
<h2><a class="anchor" id="tr_sb_actualBuild"></a>
Build</h2>
<p>Please follow commands below in a shell/terminal (e.g., Bash (<a href="http://www.gnu.org/software/bash/">http://www.gnu.org/software/bash/</a>)). They will configure and build CaPTk using GNU Make (<a href="http://www.gnu.org/software/make/">http://www.gnu.org/software/make/</a>). The main CMake configuration file (CMakeLists.txt) is located in the root directory of the package. <b>Windows</b> users need to follow the equivalent graphical interface or from PowerShell.</p>
<p>An example of the list of commands to run to compile CaPTk and its dependencies:</p>
<pre class="fragment">git clone https://github.com/CBICA/CaPTk.git
git lfs fetch --all # downloads all the precompiled binaries for different applications and Qt with the required installation options
cd CaPTk
git submodule update --init --recursive # this ensures all submodules are initialized and up-to-date
mkdir build # this is where we will build all the binaries
cd build
cmake .. # configure the superbuild first - builds ITK, VTK and OpenCV based on specific Qt version which is downloaded
make -j # multi-threaded compilation: use 'make -j${N}' to specify number of threads to use; on Windows, compile the ALL_BUILD project
cmake -DCMAKE_INSTALL_PREFIX=${path_to_where_you_want_to_install} .. # configure CaPTk
make -j # multi-threaded compilation: use 'make -j${N}' to specify number of threads to use; on Windows, compile the ALL_BUILD project
make install/strip # installs CaPTk and all its files to ${path_to_where_you_want_to_install}; on Windows, compile the INSTALL project
</pre><hr  />
<h1><a class="anchor" id="tr_cppIntegration"></a>
Integrating your C++ application into CaPTk</h1>
<p>Let’s say the name of your application is <b>yourSourceApp</b>. The following steps highlight the steps required for you to integrate your application into CaPTk:</p>
<ul style="list-style-type:disc">
<li>
Input and Output of files is handled by the graphical layer, which takes into account file handling, directory sorting, etc. so you can worry about the important stuff, i.e., your algorithm.  </li>
<li>
We are currently developing actively on MSVC/12 - Visual Studio 2013 (<a href="https://www.microsoft.com/en-US/download/details.aspx?id=44914">https://www.microsoft.com/en-US/download/details.aspx?id=44914</a>) and GCC/4.9.2. Plans are in motion to migrate to MSVC/14 - Visual Studio 2015 (<a href="https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx">https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx</a>) and GCC/5.x very soon, upon which all C++11 features (<a href="https://en.wikipedia.org/wiki/C%2B%2B11">https://en.wikipedia.org/wiki/C%2B%2B11</a>) will be enabled by default.  </li>
<li>
The graphical layer reads DICOM or NIfTI files and passes it on as an ITK-Image (<a href="http://www.itk.org/Doxygen/html/classitk_1_1Image.html">http://www.itk.org/Doxygen/html/classitk_1_1Image.html</a>). The data type defaults to the same type in which the original image was written. This is done using the ITK-ImageIOBase class (<a href="http://www.itk.org/Doxygen/html/classitk_1_1ImageIOBase.html">http://www.itk.org/Doxygen/html/classitk_1_1ImageIOBase.html</a>).  </li>
<li>
Your application should read either a single ITK-Image or a vector (<a href="http://www.cplusplus.com/reference/vector/vector/">http://www.cplusplus.com/reference/vector/vector/</a>) of ITK-Images and give output in a similar format (either a single ITK-Image or a vector of ITK-Images).  </li>
<li>
<b>yourSourceApp</b> should be structured as a single class, i.e., a collection of <b>yourSourceApp.h</b> and <b>yourSourceApp.cpp</b> (ensure that the extensions match up otherwise CMake won’t pick them up as valid applications). Put the class implementation in the following folder - <b>$PROJECT_SOURCE_DIR/src/applications</b> and let CMake pick your application up in the next compilation step.  </li>
<li>
If your algorithm does any kind of compilation or builds dependencies (libraries, executables, etc.), ensure that all the new files (non-source code files) are generated out-of-source. This is done to ensure that packaging the final application can happen in a concurrent manner. </li>
<li>
CaPTk is able to handle application-specific dependencies well. For example, if you prefer the SVM implementation of LibSVM (<a href="https://github.com/cjlin1/libsvm">https://github.com/cjlin1/libsvm</a>) rather than that of OpenCV (<a href="http://docs.opencv.org/2.4/modules/ml/doc/support_vector_machines.html">http://docs.opencv.org/2.4/modules/ml/doc/support_vector_machines.html</a>), you can simply create a new folder called /yourSourceApp_includes under <b>$PROJECT_SOURCE_DIR/src/applications</b> and let CMake take care of the configuration. <b>yourSourceApp</b> will see the includes as if it was present in the same folder (i.e., no need to specify folder when including these dependencies).  </li>
</ul>
<hr  />
<h1><a class="anchor" id="tr_pyIntegration"></a>
Integrating your Python application into CaPTk</h1>
<p>Let’s say the name of your application is <b>yourPythonApp</b>. The following steps give a brief high-level overview regarding the steps required for integrating it with CaPTk:</p>
<ul style="list-style-type:disc">
<li>
Input and Output of files is handled by the graphical layer, which takes into account file handling, directory sorting, etc. so you can worry about the important stuff, i.e., your algorithm.  </li>
<li>
For interpreted languages such as Python, the graphical layer writes a NIfTI file (yes, there is disk I/O, yes it is inefficient, yes it is stupid but there is no other way around it so just deal with it).  </li>
<li>
Your application should be structured as a single <b>yourPythonApp.py</b> script (can be a class or pipeline). This should be present in the <b>$PROJECT_SOURCE_DIR/src/applications/py</b> directory. Your application should also have a file analogous to the setup.py (<a href="https://pythonhosted.org/an_example_pypi_project/setuptools.html">https://pythonhosted.org/an_example_pypi_project/setuptools.html</a>) file used in Python projects by the name <b>yourPythonApp_setup.py</b>.  </li>
<li>
The Python configuration creates a virtual environment in the <b>$PROJECT_BINARY_DIR/py</b> directory, where all the dependencies are constructed.  </li>
<li>
Your application should support command line interfaces properly (verbose parameters throughout at the very least).  </li>
<li>
Add a new application under the <b>APP_LIST_PY_GUI</b> in <code>CaPTk_source_code/src/applications/CMakeLists.txt</code> and then make the corresponding addition in the <code>fMainWindow</code> and <code>ui_fMainWindow</code> class (take LIBRA as a starting point). </li>
<li>
Once you have a menu item and the corresponding function call for your application, you can recompile CaPTk and then it will be able to pick up your application </li>
</ul>
<hr  />
<hr  />
<p> 
<div align="right"><a href="Download.html"><b>Next (Download)<b></a>
</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<class="footer">
					Generated by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"/></a>.
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>
